<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yilin (Gevin) Zhu - Retro Portfolio</title>
    
    <!-- 1. Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Configure Tailwind Theme -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        retro: {
                            bg: 'var(--bg-main)',
                            panel: 'var(--bg-panel)',
                            window: 'var(--bg-window)',
                            content: 'var(--bg-content)',
                            text: 'var(--text-main)',
                            dim: 'var(--text-dim)',
                            inverse: 'var(--text-inverse)',
                            border: 'var(--border-main)',
                            accent: 'var(--accent-main)',
                            'accent-dim': 'var(--accent-dim)',
                        }
                    }
                }
            }
        }
    </script>

    <!-- 3. Load React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- 4. Load Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 5. Load Lucide Icons (Vanilla UMD) -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Font Injection & CSS Variables -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap');
        
        :root {
            /* NIGHT MODE (DEFAULT) - Cyberpunk Yellow */
            --bg-main: #000000;
            --bg-panel: #09090b; /* zinc-950 */
            --bg-window: #18181b; /* zinc-900 */
            --bg-content: #09090b; /* zinc-950 */
            
            --text-main: #d4d4d8; /* zinc-300 */
            --text-dim: #71717a; /* zinc-500 */
            --text-inverse: #000000;
            
            --border-main: #27272a; /* zinc-800 */
            
            --accent-main: #eab308; /* yellow-500 */
            --accent-rgb: 234, 179, 8;
            --accent-dim: rgba(234, 179, 8, 0.1);
            --accent-glow: rgba(234, 179, 8, 0.5);
            
            --scanline-opacity: 0.6;
            --flicker-opacity: 0.02;
            
            /* Dynamic Hue Rotation Variable */
            --hue-rotate: 0deg;
        }

        .day-mode {
            /* DAY MODE - Deep Amber / Industrial Orange */
            --bg-main: #e4e4e7; /* zinc-200 */
            --bg-panel: #f4f4f5; /* zinc-100 */
            --bg-window: #ffffff; /* white */
            --bg-content: #fafafa; /* zinc-50 */
            
            --text-main: #18181b; /* zinc-900 */
            --text-dim: #71717a; /* zinc-500 */
            --text-inverse: #ffffff;
            
            --border-main: #a1a1aa; /* zinc-400 */
            
            /* Changed to Amber-700 for much higher contrast on white */
            --accent-main: #b45309; 
            --accent-rgb: 180, 83, 9;
            --accent-dim: rgba(180, 83, 9, 0.1);
            --accent-glow: rgba(180, 83, 9, 0.4);
            
            --scanline-opacity: 0.15;
            --flicker-opacity: 0.01;
        }

        .font-pixel { font-family: 'VT323', monospace; font-size: 1.2rem; }
        /* FIX: Changed 'Press+Start+2P' to 'Press Start 2P' */
        .font-pixel-bold { font-family: 'Press Start 2P', cursive; }
        
        @keyframes flicker {
            0% { opacity: var(--flicker-opacity); }
            5% { opacity: 0.05; }
            10% { opacity: var(--flicker-opacity); }
            100% { opacity: var(--flicker-opacity); }
        }
        .animate-flicker { animation: flicker 0.15s infinite; }
        
        /* Scrollbar Hiding */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        /* Error Screen Style */
        #error-display { display: none; color: #ef4444; background: #18181b; padding: 20px; font-family: monospace; height: 100vh; width: 100vw; position: fixed; top: 0; left: 0; z-index: 10000; }

        /* --- GRANULAR ACCESSIBILITY STYLES --- */
        
        /* 1. Readable Font */
        .a11y-font, .a11y-font * {
            font-family: ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif !important;
            letter-spacing: normal !important;
        }
        /* Ensure icons keep their size/shape */
        .a11y-font svg {
            font-family: inherit !important;
        }

        /* 2. Reduce Motion */
        .a11y-motion *, .a11y-motion {
            animation: none !important;
            transition: none !important;
        }

        /* 3. Clean View (Remove Text Shadows & CRT effects handled in JS) */
        .a11y-clean * {
            text-shadow: none !important;
            box-shadow: none !important;
        }

        /* 4. Large Text (Scale Root Font handled in JS) */
        
        /* 5. Grayscale */
        .a11y-grayscale {
            filter: grayscale(100%) !important;
        }

        /* 6. Dynamic Hue (Replaced fixed invert) */
        .a11y-hue-filter {
            filter: hue-rotate(var(--hue-rotate)) !important;
        }
        /* Rotate images back so they look natural */
        .a11y-hue-filter img, .a11y-hue-filter video {
            filter: hue-rotate(calc(var(--hue-rotate) * -1)) !important;
        }

        /* 7. Wide Spacing */
        .a11y-spacing, .a11y-spacing * {
            line-height: 1.8 !important;
            letter-spacing: 0.1em !important;
            word-spacing: 0.1em !important;
        }

        /* 8. Link Highlights */
        .a11y-links a, .a11y-links button, .a11y-links [role="button"], .a11y-links .cursor-pointer {
            text-decoration: underline !important;
            text-decoration-thickness: 2px !important;
            text-underline-offset: 4px !important;
        }
        
    </style>
</head>
<body class="bg-retro-bg text-retro-text overflow-hidden h-screen w-screen transition-colors duration-300">
    <div id="root"></div>
    <div id="error-display"></div>

    <script type="text/babel">
        // --- ERROR TRAPPING ---
        window.onerror = function(message, source, lineno, colno, error) {
            const el = document.getElementById('error-display');
            el.style.display = 'block';
            el.innerHTML = `<strong>SYSTEM ERROR:</strong><br/>${message}<br/><br/>See console for details.`;
        };

        try {
            const { useState, useEffect, useRef, useCallback } = React;

            // --- ICON ADAPTER ---
            const toPascalCase = (str) => str.charAt(0).toUpperCase() + str.slice(1);

            const LucideIcon = ({ name, size = 24, color = "currentColor", strokeWidth = 2, className, ...props }) => {
                const iconName = name.charAt(0).toLowerCase() + name.slice(1);
                const iconData = lucide.icons[iconName] || lucide.icons[name];
                
                if (!iconData) {
                    console.warn(`Icon not found: ${name}`);
                    return null;
                }
                
                return (
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width={size}
                        height={size}
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke={color}
                        strokeWidth={strokeWidth}
                        strokeLinecap="round"
                        strokeLinejoin="round"
                        className={className}
                        {...props}
                    >
                        {iconData.map(([tag, attrs], i) => React.createElement(tag, { key: i, ...attrs }))}
                    </svg>
                );
            };

            const Icons = {};
            if (window.lucide && window.lucide.icons) {
                Object.keys(window.lucide.icons).forEach(key => {
                    const pascalKey = toPascalCase(key);
                    Icons[pascalKey] = (props) => <LucideIcon name={key} {...props} />;
                });
            } else {
                throw new Error("Lucide icons library failed to load.");
            }

            const SafeIcon = (name) => Icons[name] || (() => null);

            // Icons Used
            const User = SafeIcon('User');
            const Briefcase = SafeIcon('Briefcase');
            const Mail = SafeIcon('Mail');
            const X = SafeIcon('X');
            const Minus = SafeIcon('Minus');
            const Square = SafeIcon('Square');
            const Cpu = SafeIcon('Cpu');
            const Terminal = SafeIcon('Terminal');
            const Folder = SafeIcon('Folder');
            const FileText = SafeIcon('FileText');
            const GraduationCap = SafeIcon('GraduationCap');
            const Layers = SafeIcon('Layers');
            const Ruler = SafeIcon('Ruler');
            const Maximize = SafeIcon('Maximize');
            const Grid = SafeIcon('Grid');
            const AlertTriangle = SafeIcon('AlertTriangle');
            const HardDrive = SafeIcon('HardDrive');
            const Monitor = SafeIcon('Monitor');
            const PenTool = SafeIcon('PenTool');
            const Power = SafeIcon('Power');
            const Move = SafeIcon('Move');
            const Zap = SafeIcon('Zap');
            const RefreshCw = SafeIcon('RefreshCw');
            const Download = SafeIcon('Download');
            const Instagram = SafeIcon('Instagram');
            const Activity = SafeIcon('Activity');
            const Wifi = SafeIcon('Wifi');
            const Gamepad2 = SafeIcon('Gamepad2');
            const Sun = SafeIcon('Sun');
            const Moon = SafeIcon('Moon');
            const Linkedin = SafeIcon('Linkedin');
            const Accessibility = SafeIcon('Accessibility');
            const Type = SafeIcon('Type');
            const EyeOff = SafeIcon('EyeOff');
            const ZoomIn = SafeIcon('ZoomIn');
            const MousePointer = SafeIcon('MousePointer');
            const Droplet = SafeIcon('Droplet'); 
            const MoveHorizontal = SafeIcon('MoveHorizontal');
            const Link2 = SafeIcon('Link2');
            const Target = SafeIcon('Target'); 
            const ScanLine = SafeIcon('ScanLine'); 
            // Changed Contrast to Palette for Hue Shift
            const Palette = SafeIcon('Palette');

            // --- PERSONAL DATA ---
            const PERSONAL_INFO = {
                name: "Yilin Zhu",
                tagline: "BUILD. BREAK. OPTIMIZE. REPEAT.", 
                intro: [
                    "MSc Candidate",
                    "Designing Human-Centered Spaces & Interfaces",
                    "Bridging Physical & Digital Experiences",
                    "(Arch + UX)"
                ],
                about: "", 
                email: "yilinzhu@atlasruanni.com",
                social: {
                    instagram: "https://instagram.com/atlasruanni",
                    linkedin: "https://www.linkedin.com/in/gevin-zhu",
                    resume: "#" 
                }
            };

            const SKILLS = [
                { name: "ARCH_DESIGN", level: 90 },
                { name: "MODEL_3D", level: 90 },
                { name: "VISL_DESIGN", level: 80 },
                { name: "UX_DESIGN", level: 80 },
                { name: "PC_HARDWARE", level: 70 },
            ];

            const EDUCATION = [
                {
                    school: "University of Toronto",
                    // Merged specialization details onto the same line as degree
                    degree: "Honours Bachelor of Arts (HBA) - Specialize in Architectural Studies, Major in Visual Studies (Design), Minor in Visual Studies (Art)",
                    period: "JUNE 2025",
                    details: "Graduated with Distinction. Focused on fundamental design principles, critical theory, and visual communication strategies."
                },
                {
                    school: "Wilfrid Laurier University",
                    degree: "Master of Science (MSc), User Experience (UX) Design",
                    period: "ETA: JAN 2027",
                    // UPDATED STATUS: Changed "The focus is on" to "Focused is on"
                    details: "Design intuitive, user-centered experiences that improve how people interact with digital and physical space and systems. Focused is on usability, satisfaction, learnability, and emotional connection across immersive technology, service design, and spatial experiences."
                }
            ];

            const EXPERIENCE = [
                {
                    company: "ZYL Tech",
                    role: "System Builder",
                    period: "2025_PRESENT",
                    description: "Building high-performance rigs from scratch. Diagnosing hardware failures, optimizing thermal airflow, and hardening Windows configs for max stability."
                },
                {
                    company: "Skyview Windows",
                    role: "CAD Drafter",
                    period: "2024_2025",
                    description: "Crushed architectural drafts and analyzed thermal data. Balanced sustainability specs with real-world building codes. Translated technical docs for stakeholders."
                },
                {
                    company: "CACR",
                    role: "Visual Lead",
                    period: "2023_2024",
                    description: "Owned the print & digital visual stack. Took concepts from wireframe to final production, ensuring brand consistency across all output channels."
                }
            ];

            const PROJECTS = [
                {
                    title: "ECO_BLUEPRINT",
                    type: "CAD_MODEL",
                    desc: "Thermal performance planning meets brutalist aesthetics.",
                    tags: ["AutoCAD", "Physics"],
                    coords: "SEC_09"
                },
                {
                    title: "BRAND_PACK_V1",
                    type: "VISUAL_ASSETS",
                    desc: "High-contrast identity system for audience engagement.",
                    tags: ["Adobe_CC", "Vector"],
                    coords: "SEC_04"
                },
                {
                    title: "RIG_CONFIGURATOR",
                    type: "HARDWARE",
                    desc: "Bespoke PC build specs tailored for extreme workloads.",
                    tags: ["Hardware", "Cooling"],
                    coords: "SEC_01"
                }
            ];

            // --- UTILITY COMPONENTS ---

            const CornerBrackets = ({ color = "border-retro-accent", size = "w-2 h-2" }) => (
                <React.Fragment>
                    <div className={`absolute -top-[2px] -left-[2px] ${size} border-t-2 border-l-2 ${color} z-20`}></div>
                    <div className={`absolute -top-[2px] -right-[2px] ${size} border-t-2 border-r-2 ${color} z-20`}></div>
                    <div className={`absolute -bottom-[2px] -left-[2px] ${size} border-b-2 border-l-2 ${color} z-20`}></div>
                    <div className={`absolute -bottom-[2px] -right-[2px] ${size} border-b-2 border-r-2 ${color} z-20`}></div>
                </React.Fragment>
            );

            const BootScreen = ({ onComplete }) => {
                const [lines, setLines] = useState([]);
                
                useEffect(() => {
                    const bootLines = [
                    "BIOS DATE 01/21/25 15:22:38 VER: 1.0.2",
                    "CPU: REACT_CORE V18.2.0, SPEED: 4.2GHz",
                    "640K RAM SYSTEM  640K RAM PASSED",
                    "DETECTING PRIMARY MASTER ... GEVIN_ZHU",
                    "DETECTING PRIMARY SLAVE  ... PORTFOLIO_DATA",
                    "LOADING KERNEL...",
                    "INITIALIZING VIDEO ADAPTER ... OK",
                    "MOUNTING VOLUMES ... OK",
                    "BOOT SEQUENCE COMPLETE."
                    ];

                    let delay = 0;
                    bootLines.forEach((line, index) => {
                    delay += Math.random() * 300 + 100;
                    setTimeout(() => {
                        setLines(prev => [...prev, line]);
                        if (index === bootLines.length - 1) {
                        setTimeout(onComplete, 800);
                        }
                    }, delay);
                    });
                }, [onComplete]);

                return (
                    <div className="fixed inset-0 bg-black z-[100] p-8 font-pixel text-yellow-400 text-lg md:text-xl flex flex-col justify-start overflow-hidden">
                    {lines.map((line, i) => (
                        <div key={i} className="mb-2 drop-shadow-[0_0_5px_rgba(234,179,8,0.5)]">{`> ${line}`}</div>
                    ))}
                    <div className="animate-pulse mt-2 bg-yellow-500 w-3 h-6 shadow-[0_0_10px_rgba(234,179,8,0.8)]"></div>
                    </div>
                );
            };

            const CRTOverlay = () => (
                <div className="pointer-events-none fixed inset-0 z-[9999] overflow-hidden h-full w-full mix-blend-hard-light">
                    {/* Scanlines - Uses CSS Variable for opacity to adjust for Day Mode */}
                    <div className="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] bg-[length:100%_4px,3px_100%] pointer-events-none" style={{ opacity: 'var(--scanline-opacity)' }}></div>
                    {/* Flicker */}
                    <div className="absolute inset-0 bg-white opacity-[0.02] animate-flicker pointer-events-none"></div>
                    {/* Vignette */}
                    <div className="absolute inset-0 bg-[radial-gradient(circle,rgba(0,0,0,0)_60%,rgba(0,0,0,0.8)_100%)] pointer-events-none"></div>
                </div>
            )

            // --- RHINO / CONSOLE ELEMENTS ---
            // XYZ Axis Widget (Rhino Style)
            const XYZAxisWidget = () => (
                <div className="absolute bottom-12 left-8 w-16 h-16 pointer-events-none z-0 hidden md:block opacity-60">
                    <svg viewBox="0 0 100 100" className="w-full h-full overflow-visible">
                        {/* Z Axis (Blue) */}
                        <line x1="50" y1="50" x2="50" y2="10" stroke="#3b82f6" strokeWidth="3" />
                        <text x="55" y="10" fill="#3b82f6" fontSize="10" className="font-pixel">Z</text>
                        {/* Y Axis (Green) */}
                        <line x1="50" y1="50" x2="90" y2="30" stroke="#22c55e" strokeWidth="3" />
                        <text x="95" y="30" fill="#22c55e" fontSize="10" className="font-pixel">Y</text>
                        {/* X Axis (Red) */}
                        <line x1="50" y1="50" x2="10" y2="30" stroke="#ef4444" strokeWidth="3" />
                        <text x="0" y="30" fill="#ef4444" fontSize="10" className="font-pixel">X</text>
                        {/* Origin */}
                        <circle cx="50" cy="50" r="2" fill="white" />
                    </svg>
                </div>
            );

            // Rhino/CAD Status Bar (Bottom Center)
            const RhinoStatusBar = () => (
                <div className="absolute bottom-1 left-1/2 -translate-x-1/2 flex gap-1 pointer-events-auto z-50 select-none">
                    {["Grid Snap", "Ortho", "Planar", "Osnap", "SmartTrack"].map((item, i) => (
                        <div key={i} className="px-2 py-0.5 bg-retro-panel border border-retro-dim/50 text-[8px] text-retro-dim font-pixel cursor-pointer hover:bg-retro-dim/20 hover:text-retro-accent transition-colors">
                            {item}
                        </div>
                    ))}
                </div>
            );

            // --- SNAKE GAME COMPONENT ---
            const SnakeGame = ({ isDayMode }) => {
                const canvasRef = useRef(null);
                const [score, setScore] = useState(0);
                const [gameStatus, setGameStatus] = useState('IDLE'); 
                const [highScore, setHighScore] = useState(0);

                // Game Logic Refs
                const gameState = useRef({
                    snake: [{x: 10, y: 10}],
                    food: {x: 15, y: 5},
                    direction: {x: 1, y: 0},
                    nextDirection: {x: 1, y: 0},
                    gridSize: 20,
                    gridW: 0,
                    gridH: 0,
                    speed: 100,
                    lastRender: 0
                });

                // Initialize and Handle Resize
                useEffect(() => {
                    const handleResize = () => {
                    if (canvasRef.current) {
                        const canvas = canvasRef.current;
                        const parent = canvas.parentElement;
                        canvas.width = parent.clientWidth;
                        canvas.height = parent.clientHeight;
                        gameState.current.gridW = Math.floor(canvas.width / gameState.current.gridSize);
                        gameState.current.gridH = Math.floor(canvas.height / gameState.current.gridSize);
                    }
                    };
                    
                    window.addEventListener('resize', handleResize);
                    handleResize(); // Initial size
                    
                    return () => window.removeEventListener('resize', handleResize);
                }, []);

                // Input Handling
                useEffect(() => {
                    const handleKeyDown = (e) => {
                    if (['p', 'P', 'Escape'].includes(e.key)) {
                        if (gameStatus === 'PLAYING') {
                            setGameStatus('PAUSED');
                        } else if (gameStatus === 'PAUSED') {
                            setGameStatus('PLAYING');
                        }
                        return;
                    }

                    if (gameStatus === 'IDLE' || gameStatus === 'GAMEOVER') {
                        if (['Enter', ' ', 'ArrowUp', 'w'].includes(e.key)) {
                        startGame();
                        }
                        return;
                    }

                    if (gameStatus !== 'PLAYING') return;

                    const { nextDirection } = gameState.current;
                    
                    switch(e.key) {
                        case 'ArrowUp': case 'w':
                        if (nextDirection.y === 0) gameState.current.nextDirection = {x: 0, y: -1};
                        break;
                        case 'ArrowDown': case 's':
                        if (nextDirection.y === 0) gameState.current.nextDirection = {x: 0, y: 1};
                        break;
                        case 'ArrowLeft': case 'a':
                        if (nextDirection.x === 0) gameState.current.nextDirection = {x: -1, y: 0};
                        break;
                        case 'ArrowRight': case 'd':
                        if (nextDirection.x === 0) gameState.current.nextDirection = {x: 1, y: 0};
                        break;
                    }
                    };

                    window.addEventListener('keydown', handleKeyDown);
                    return () => window.removeEventListener('keydown', handleKeyDown);
                }, [gameStatus]);

                const startGame = () => {
                    gameState.current.snake = [{x: 10, y: 10}, {x: 9, y: 10}, {x: 8, y: 10}];
                    gameState.current.direction = {x: 1, y: 0};
                    gameState.current.nextDirection = {x: 1, y: 0};
                    gameState.current.score = 0;
                    setScore(0);
                    setGameStatus('PLAYING');
                    placeFood();
                };

                const placeFood = () => {
                    const { gridW, gridH, snake } = gameState.current;
                    let valid = false;
                    let newFood = {};
                    
                    while (!valid) {
                    newFood = {
                        x: Math.floor(Math.random() * gridW),
                        y: Math.floor(Math.random() * gridH)
                    };
                    valid = !snake.some(segment => segment.x === newFood.x && segment.y === newFood.y);
                    }
                    gameState.current.food = newFood;
                };

                const gameOver = () => {
                    setGameStatus('GAMEOVER');
                    if (score > highScore) setHighScore(score);
                };

                // Game Loop
                useEffect(() => {
                    if (gameStatus !== 'PLAYING') return;

                    let animationFrameId;
                    let lastTime = 0;

                    const loop = (time) => {
                    if (time - lastTime > gameState.current.speed) {
                        update();
                        lastTime = time;
                    }
                    draw();
                    animationFrameId = requestAnimationFrame(loop);
                    };

                    const update = () => {
                    const state = gameState.current;
                    state.direction = state.nextDirection;

                    const head = { ...state.snake[0] };
                    head.x += state.direction.x;
                    head.y += state.direction.y;

                    if (head.x < 0) head.x = state.gridW - 1;
                    if (head.x >= state.gridW) head.x = 0;
                    if (head.y < 0) head.y = state.gridH - 1;
                    if (head.y >= state.gridH) head.y = 0;

                    if (state.snake.some(s => s.x === head.x && s.y === head.y)) {
                        gameOver();
                        return;
                    }

                    state.snake.unshift(head);

                    if (head.x === state.food.x && head.y === state.food.y) {
                        setScore(s => s + 10);
                        placeFood();
                    } else {
                        state.snake.pop();
                    }
                    };

                    const draw = () => {
                    const canvas = canvasRef.current;
                    if (!canvas) return;
                    const ctx = canvas.getContext('2d');
                    const { gridSize, snake, food } = gameState.current;

                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    // --- CAD BACKGROUND GRID DRAWING (CLEANED UP) ---
                    const gridColor = isDayMode ? 'rgba(180, 83, 9, 0.1)' : 'rgba(234, 179, 8, 0.1)';
                    const majorGridColor = isDayMode ? 'rgba(180, 83, 9, 0.3)' : 'rgba(234, 179, 8, 0.3)';
                    
                    ctx.lineWidth = 1;
                    
                    // Draw Vertical Lines (Removed Text Coordinates for cleaner look)
                    for (let x = 0; x <= canvas.width; x += gridSize) {
                        const isMajor = (x / gridSize) % 5 === 0;
                        ctx.beginPath();
                        ctx.strokeStyle = isMajor ? majorGridColor : gridColor;
                        // Major lines are slightly clearer
                        ctx.lineWidth = isMajor ? 1.5 : 0.5; 
                        ctx.moveTo(x, 0);
                        ctx.lineTo(x, canvas.height);
                        ctx.stroke();
                    }

                    // Draw Horizontal Lines (Removed Text Coordinates)
                    for (let y = 0; y <= canvas.height; y += gridSize) {
                        const isMajor = (y / gridSize) % 5 === 0;
                        ctx.beginPath();
                        ctx.strokeStyle = isMajor ? majorGridColor : gridColor;
                        ctx.lineWidth = isMajor ? 1.5 : 0.5;
                        ctx.moveTo(0, y);
                        ctx.lineTo(canvas.width, y);
                        ctx.stroke();
                    }
                    // -----------------------------------

                    const foodColor = isDayMode ? '#18181b' : '#ffffff';
                    const headColor = isDayMode ? 'var(--accent-main)' : '#fef08a';
                    const bodyColor = isDayMode ? '#d97706' : '#eab308';
                    const glowColor = isDayMode ? 'var(--accent-main)' : '#ffffff';

                    ctx.fillStyle = foodColor;
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = glowColor;
                    ctx.fillRect(food.x * gridSize, food.y * gridSize, gridSize - 2, gridSize - 2);
                    ctx.shadowBlur = 0;

                    snake.forEach((segment, i) => {
                        if (i === 0) {
                            ctx.fillStyle = isDayMode ? '#b45309' : '#fef08a'; 
                            ctx.shadowBlur = 10;
                            ctx.shadowColor = isDayMode ? 'rgba(0,0,0,0.2)' : '#eab308';
                        } else {
                            ctx.fillStyle = isDayMode ? '#d97706' : '#eab308'; 
                            ctx.shadowBlur = 0;
                        }
                        ctx.fillRect(segment.x * gridSize, segment.y * gridSize, gridSize - 2, gridSize - 2);
                    });
                    };

                    animationFrameId = requestAnimationFrame(loop);
                    return () => cancelAnimationFrame(animationFrameId);
                }, [gameStatus, isDayMode]); 

                useEffect(() => {
                    if (gameStatus !== 'PLAYING' && gameStatus !== 'PAUSED') {
                        // When idle, draw the grid once so the background isn't empty
                        const canvas = canvasRef.current;
                        if (canvas) {
                            const ctx = canvas.getContext('2d');
                            const { gridSize } = gameState.current;
                            
                            // Clear previous frame
                            ctx.clearRect(0, 0, canvas.width, canvas.height);
                            
                            // --- IDLE GRID DRAWING (Clean version) ---
                            const gridColor = isDayMode ? 'rgba(180, 83, 9, 0.1)' : 'rgba(234, 179, 8, 0.1)';
                            const majorGridColor = isDayMode ? 'rgba(180, 83, 9, 0.3)' : 'rgba(234, 179, 8, 0.3)';
                            
                            for (let x = 0; x <= canvas.width; x += gridSize) {
                                const isMajor = (x / gridSize) % 5 === 0;
                                ctx.beginPath();
                                ctx.strokeStyle = isMajor ? majorGridColor : gridColor;
                                ctx.lineWidth = isMajor ? 1.5 : 0.5;
                                ctx.moveTo(x, 0);
                                ctx.lineTo(x, canvas.height);
                                ctx.stroke();
                            }
                            for (let y = 0; y <= canvas.height; y += gridSize) {
                                const isMajor = (y / gridSize) % 5 === 0;
                                ctx.beginPath();
                                ctx.strokeStyle = isMajor ? majorGridColor : gridColor;
                                ctx.lineWidth = isMajor ? 1.5 : 0.5;
                                ctx.moveTo(0, y);
                                ctx.lineTo(canvas.width, y);
                                ctx.stroke();
                            }
                        }
                    }
                }, [gameStatus, isDayMode]); 

                return (
                    <div className="absolute inset-0 flex items-center justify-center z-0" onClick={() => window.focus()}>
                    <canvas ref={canvasRef} className="absolute inset-0 z-0 block opacity-80" />
                    
                    <div className="relative z-10 text-center">
                        {gameStatus === 'IDLE' && (
                        <div className="animate-pulse space-y-4">
                            <h2 className="text-4xl font-pixel-bold text-retro-accent drop-shadow-[0_0_10px_var(--accent-dim)]">SYSTEM_IDLE</h2>
                            
                            <div className="inline-flex flex-col items-center gap-2 border-2 border-retro-accent bg-retro-panel/80 px-8 py-4 cursor-pointer hover:bg-retro-accent-dim transition-colors" onClick={startGame}>
                                <div className="flex items-center gap-3">
                                    <Gamepad2 className="text-retro-accent" />
                                    <span className="text-retro-text font-pixel tracking-widest text-lg">PRESS SPACE</span>
                                </div>
                                <span className="text-retro-dim font-pixel text-xs tracking-widest border-t border-retro-dim/30 pt-1 w-full">OR CLICK TO START</span>
                            </div>
                        </div>
                        )}

                        {gameStatus === 'PAUSED' && (
                        <div className="space-y-4 bg-retro-panel/90 p-8 border-2 border-retro-accent shadow-[0_0_30px_rgba(0,0,0,0.4)] backdrop-blur-sm">
                            <h2 className="text-4xl font-pixel-bold text-retro-accent animate-pulse">SYSTEM_PAUSED</h2>
                            <div className="font-pixel text-xl text-retro-text">SCORE: {score}</div>
                            <div className="font-pixel text-sm text-retro-dim mt-4">PRESS 'P' TO RESUME</div>
                            <button 
                                onClick={() => setGameStatus('PLAYING')}
                                className="mt-4 px-6 py-2 bg-retro-bg border-2 border-retro-text text-retro-text font-pixel hover:bg-retro-text hover:text-retro-inverse transition-all"
                            >
                                RESUME
                            </button>
                        </div>
                        )}

                        {gameStatus === 'GAMEOVER' && (
                        <div className="space-y-4 bg-zinc-950/90 p-8 border-2 border-red-600 shadow-[0_0_30px_rgba(220,38,38,0.4)] backdrop-blur-sm">
                            <h2 className="text-4xl font-pixel-bold text-red-600 animate-pulse">CONNECTION_LOST</h2>
                            <div className="font-pixel text-xl text-red-400">SCORE: {score}</div>
                            <div className="font-pixel text-sm text-red-500/70 mb-4">HIGH_SCORE: {highScore}</div>
                            <button 
                                onClick={startGame}
                                className="px-6 py-2 bg-black border-2 border-red-600 text-red-600 font-pixel hover:bg-red-600 hover:text-black transition-all"
                            >
                                RETRY_SEQUENCE()
                            </button>
                        </div>
                        )}
                    </div>

                    {/* PLAYING STATE UI - Moved outside the centered container for absolute positioning relative to screen */}
                        {gameStatus === 'PLAYING' && (
                            <React.Fragment>
                                {/* Score at Top */}
                                <div className="absolute top-12 left-1/2 -translate-x-1/2 flex flex-col items-center pointer-events-none z-20 select-none">
                                    <div className="font-pixel-bold text-retro-accent text-4xl drop-shadow-[0_0_10px_var(--accent-dim)]">
                                        {score}
                                    </div>
                                </div>
                                
                                {/* Pause Instruction at Bottom - Increased size from text-[10px] to text-sm */}
                                <div className="absolute bottom-12 left-1/2 -translate-x-1/2 text-sm text-retro-dim font-pixel tracking-[0.2em] pointer-events-none z-20 select-none opacity-60">
                                    PRESS 'P' TO PAUSE
                                
                                </div>
                            </React.Fragment>
                        )}

                    </div>
                );
            };

            // --- COMPONENT: CAD WINDOW FRAME ---
            const WindowFrame = ({ id, title, icon: Icon, isOpen, isMinimized, onClose, onMinimize, onFocus, zIndex, position, onMouseDown, children }) => {
                if (!isOpen) return null;

                return (
                    <div 
                    className={`absolute w-[95%] h-[85%] md:w-[900px] md:h-[650px] bg-retro-window/95 border-x-2 border-b-2 border-retro-border border-t-2 border-t-retro-accent backdrop-blur-sm shadow-[0_0_30px_rgba(0,0,0,0.4)] flex flex-col overflow-hidden transition-opacity duration-200 ${isMinimized ? 'opacity-0 pointer-events-none' : 'opacity-100'}`}
                    style={{ 
                        zIndex,
                        left: position.x,
                        top: position.y,
                        transform: isMinimized ? 'scale(0.9)' : 'scale(1)'
                    }}
                    onMouseDown={onFocus}
                    >
                    <CornerBrackets color="border-retro-accent" size="w-3 h-3" />

                    <div 
                        className="bg-retro-panel h-10 flex items-center justify-between px-3 border-b-2 border-retro-border select-none cursor-move group active:cursor-grabbing relative overflow-hidden"
                        onMouseDown={(e) => onMouseDown(e, id)}
                    >
                        <div className="absolute inset-0 opacity-10 pointer-events-none" style={{ backgroundImage: 'repeating-linear-gradient(45deg, transparent, transparent 10px, var(--accent-main) 10px, var(--accent-main) 11px)' }}></div>

                        <div className="flex items-center gap-3 text-retro-accent font-pixel-bold text-xs tracking-wider relative z-10 shadow-[0_0_10px_var(--accent-dim)]">
                        <Icon size={16} strokeWidth={2.5} />
                        <span className="uppercase">{title}</span>
                        </div>
                        
                        <div className="flex items-center gap-1 relative z-10">
                        <button onClick={(e) => { e.stopPropagation(); onMinimize(); }} className="w-6 h-6 flex items-center justify-center bg-retro-bg hover:bg-retro-panel text-retro-accent border-2 border-retro-border hover:border-retro-accent transition-all">
                            <Minus size={12} strokeWidth={3} />
                        </button>
                        <button onClick={(e) => { e.stopPropagation(); onClose(); }} className="w-6 h-6 flex items-center justify-center bg-retro-bg hover:bg-red-900/30 text-retro-text border-2 border-retro-border hover:border-retro-text transition-all">
                            <X size={12} strokeWidth={3} />
                        </button>
                        </div>
                    </div>

                    <div className="flex flex-1 overflow-hidden relative">
                        {/* Sidebar */}
                        <div className="w-8 bg-retro-content border-r-2 border-retro-border hidden md:flex flex-col items-center py-2 gap-12 text-base text-retro-accent font-pixel select-none z-10">
                        {[...Array(8)].map((_, i) => <span key={i} className="rotate-90 origin-center whitespace-nowrap">0x{i}F</span>)}
                        </div>

                        {/* Content Area Wrapper (Separates BG from Scroll) */}
                        <div className="flex-1 relative bg-retro-content h-full">
                            
                            {/* Background Layer (Absolute, Fills Wrapper, Static) */}
                            <div className="absolute inset-0 pointer-events-none opacity-[0.08]"
                                style={{ backgroundImage: 'linear-gradient(var(--accent-main) 1px, transparent 1px), linear-gradient(90deg, var(--accent-main) 1px, transparent 1px)', backgroundSize: '40px 40px' }}>
                            </div>

                            {/* Scrollable Content Layer (Absolute Inset-0, Scrolls) */}
                            <div className="absolute inset-0 overflow-y-auto scrollbar-thin scrollbar-thumb-retro-accent scrollbar-track-retro-bg [&::-webkit-scrollbar]:hidden [-ms-overflow-style:'none'] [scrollbar-width:'none']">
                                <div className="relative z-10 p-6 min-h-full pb-20 font-pixel text-retro-text leading-relaxed cursor-text">
                                    {children}
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className="h-10 bg-retro-panel border-t-2 border-retro-border flex items-center px-4 justify-between text-lg font-pixel text-retro-accent select-none relative">
                        <div className="flex gap-6">
                            <span>MEM: OK</span>
                            <span>GRID: ACTIVE</span>
                            <span className="hidden sm:inline">X:{Math.round(position.x)} Y:{Math.round(position.y)}</span>
                        </div>
                        <div className="uppercase animate-pulse flex items-center gap-2 text-retro-accent">
                            <div className="w-2 h-2 bg-retro-accent rounded-full shadow-[0_0_5px_var(--accent-main)]"></div>
                            SYS_READY
                        </div>
                    </div>
                    </div>
                );
            };

            // --- COMPONENT: TOOL ICON ---
            const ToolIcon = ({ label, icon: Icon, onClick, active, shadowDirection = 'down', className = '' }) => {
                const shadowClass = shadowDirection === 'up' 
                    ? 'shadow-[0_-4px_0px_var(--accent-dim)] hover:shadow-[0_0_15px_var(--accent-glow)] hover:translate-y-[-2px]'
                    : 'shadow-[0_4px_0px_var(--accent-dim)] hover:shadow-[0_0_15px_var(--accent-glow)] hover:translate-y-[2px]';
                    
                const activeShadowClass = shadowDirection === 'up'
                    ? 'shadow-[0_0_10px_var(--accent-glow)] translate-y-[-2px] border-retro-accent'
                    : 'shadow-[0_0_10px_var(--accent-glow)] translate-y-[2px] border-retro-accent';

                return (
                    <button 
                        onClick={onClick}
                        // Changed w-12 h-12 to w-[3rem] h-[3rem] to strictly enforce scaling with root font size
                        className={`group relative flex items-center justify-center w-[3rem] h-[3rem] transition-all duration-200 border-2 border-retro-border bg-retro-panel cursor-pointer
                            ${active 
                                ? `text-retro-accent ${activeShadowClass}` 
                                : `text-retro-dim hover:text-retro-accent hover:border-retro-accent ${shadowClass}`
                            }
                            ${className}
                        `}
                        title={label}
                    >
                        {/* Changed fixed 20px size to 1.5rem so it scales with root font size */}
                        <Icon size="1.5rem" strokeWidth={2} />
                        
                        <div className="absolute left-full ml-[1.25rem] opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50">
                            <div className="relative bg-retro-panel text-retro-accent text-[0.625rem] px-3 py-1 border-2 border-retro-accent font-pixel-bold uppercase tracking-wider shadow-[0_0_10px_var(--accent-dim)] whitespace-nowrap">
                                <CornerBrackets color="border-retro-accent" size="w-1.5 h-1.5" />
                                <span className="relative z-10">&gt;&gt; {label}</span>
                            </div>
                            <div className="absolute top-1/2 right-full w-3 h-[2px] bg-retro-accent transform -translate-y-1/2"></div>
                        </div>
                    </button>
                );
            };

            // --- WINDOW CONTENTS ---

            const SkillBar = ({ skill }) => {
                const [load, setLoad] = useState(0);
                const [overclocked, setOverclocked] = useState(false);
                
                useEffect(() => {
                    const timeout = setTimeout(() => setLoad(skill.level), 300);
                    return () => clearTimeout(timeout);
                }, [skill.level]);

                const triggerOverclock = () => {
                    setOverclocked(true);
                    setTimeout(() => setOverclocked(false), 2000);
                }

                return (
                    <div className="group mb-4 last:mb-0 cursor-pointer select-none" onClick={triggerOverclock}>
                        <div className="flex justify-between text-xs text-retro-dim mb-1 font-pixel-bold">
                        <span className={`transition-colors flex items-center gap-2 ${overclocked ? 'text-red-500' : 'group-hover:text-retro-accent'}`}>
                            <span className={`w-1 h-1 rounded-full ${overclocked ? 'bg-red-500 animate-ping' : 'bg-retro-accent'}`}></span>
                            {skill.name}
                        </span>
                        <span className={`font-pixel ${overclocked ? 'text-red-500 animate-pulse' : 'text-retro-accent'}`}>
                            {overclocked ? 'WARNING: OVERLOAD' : `${load}%`}
                        </span>
                        </div>
                        <div className={`flex gap-[2px] h-3 p-[2px] border-2 bg-retro-bg relative transition-colors ${overclocked ? 'border-red-500/80' : 'border-retro-border'}`}>
                        <div className={`absolute -left-[2px] -top-[2px] w-1 h-1 border-t-2 border-l-2 ${overclocked ? 'border-red-500' : 'border-retro-dim'}`}></div>
                        <div className={`absolute -right-[2px] -bottom-[2px] w-1 h-1 border-b-2 border-r-2 ${overclocked ? 'border-red-500' : 'border-retro-dim'}`}></div>
                        
                        {[...Array(10)].map((_, i) => (
                            <div 
                                key={i} 
                                className={`flex-1 transition-all duration-150 ${
                                    (i * 10) < (overclocked ? 100 : load) 
                                        ? (overclocked ? 'bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.9)]' : 'bg-retro-accent shadow-[0_0_5px_var(--accent-dim)]') 
                                        : 'bg-retro-panel/50'
                                }`}
                            ></div>
                        ))}
                        </div>
                    </div>
                )
            }

            const AboutContent = () => (
                <div className="space-y-10 min-h-full flex flex-col justify-start pt-4 max-w-4xl mx-auto relative">
                    <div className="flex flex-col md:flex-row gap-12 items-center justify-center relative z-10">
                    <div className="w-full md:w-56 shrink-0 relative group">
                        <div className="absolute -inset-1 bg-retro-accent/20 blur-sm group-hover:bg-retro-accent/30 transition-all"></div>
                        {/* 1. Changed photo border from accent/50 to dim/50 (gray) */}
                        <div className="aspect-[3/4] bg-black border-2 border-retro-dim/50 relative overflow-hidden">
                            <CornerBrackets color="border-retro-accent" />
                            <div className="absolute inset-0 flex items-center justify-center bg-[linear-gradient(transparent_50%,rgba(0,0,0,0.5)_50%)] bg-[length:100%_4px] z-10 pointer-events-none opacity-50"></div>
                            <User size={64} className="text-retro-accent/80 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2" />
                            {/* 3. Removed the small '01' binary background text */}
                            <div className="absolute bottom-0 w-full bg-retro-accent/10 border-t-2 border-retro-dim/50 p-2 backdrop-blur-sm z-20">
                                {/* 2. Changed border-t-2 from accent/50 to dim/50 (gray) */}
                                <div className="text-[0.625rem] text-retro-accent font-pixel-bold">ID: GEVIN_ZHU</div>
                                <div className="text-[0.5rem] text-retro-dim">CLASS: ARCHITECT</div>
                            </div>
                        </div>
                    </div>

                    <div className="flex-1">
                        {/* Name Header */}
                        <h1 className="text-xl md:text-3xl text-retro-accent font-pixel-bold mb-1 leading-tight drop-shadow-[0_0_5px_var(--accent-dim)] whitespace-nowrap">
                            {PERSONAL_INFO.name}
                        </h1>
                        
                        <div className="text-lg font-pixel text-retro-accent mb-6">
                            OTHER NAME: GEVIN
                        </div>
                        
                        {/* PLAIN TEXT INTRO SECTION */}
                        <div className="flex flex-col gap-2 mb-8">
                            {PERSONAL_INFO.intro.map((line, i) => (
                                <div key={i} className="text-xs font-pixel-bold text-retro-dim">
                                    {line}
                                </div>
                            ))}
                        </div>
                        
                        {PERSONAL_INFO.about && (
                            <p className="text-retro-text text-lg md:text-xl leading-8 border-l-4 border-retro-accent/30 pl-6 mb-8 relative">
                            <span className="absolute -left-[6px] top-0 w-2 h-2 bg-retro-accent/50"></span>
                            {PERSONAL_INFO.about}
                            </p>
                        )}
                        
                        <div className="flex flex-wrap gap-4 justify-start md:justify-start mt-8">
                        <a href={PERSONAL_INFO.social.linkedin} target="_blank" rel="noopener noreferrer" className="relative group px-6 py-3 bg-retro-bg border-2 border-retro-border hover:border-retro-accent text-retro-dim hover:text-retro-accent text-xs font-pixel-bold uppercase transition-all overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-retro-accent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div className="flex items-center gap-2 relative z-10">
                                {/* Changed fixed size 14 to 0.875rem */}
                                <Linkedin size="0.875rem" /> 
                                <span>LINKEDIN_UPLINK</span>
                            </div>
                        </a>
                        <a href={PERSONAL_INFO.social.instagram} target="_blank" rel="noopener noreferrer" className="relative group px-6 py-3 bg-retro-bg border-2 border-retro-border hover:border-retro-accent text-retro-dim hover:text-retro-accent text-xs font-pixel-bold uppercase transition-all overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-[2px] bg-gradient-to-r from-transparent via-retro-accent to-transparent opacity-0 group-hover:opacity-100 transition-opacity"></div>
                            <div className="flex items-center gap-2 relative z-10">
                                {/* Changed fixed size 14 to 0.875rem */}
                                <Instagram size="0.875rem" />
                                <span>INSTA_FEED</span>
                            </div>
                        </a>
                        </div>
                    </div>
                    </div>

                    <div className="border-t-2 border-retro-border pt-8 pb-8 relative">
                    {/* Changed text-[8px] to text-[0.5rem] for scaling */}
                    <div className="absolute top-[-8px] left-1/2 -translate-x-1/2 bg-retro-bg border border-retro-border px-2 text-[0.5rem] font-pixel-bold text-retro-accent tracking-widest uppercase">SYS_DIAGNOSTICS</div>
                    <div className="flex items-center gap-3 mb-6">
                        <Activity size={18} className="text-retro-accent" />
                        <span className="text-retro-accent font-pixel-bold text-sm">PERFORMANCE METRICS</span>
                    </div>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-x-12 gap-y-4">
                        {SKILLS.map((skill, i) => (
                            <SkillBar key={i} skill={skill} />
                        ))}
                    </div>
                    </div>
                </div>
            );

            const ExperienceContent = () => (
                <div className="space-y-12 pl-4">
                    <div className="relative border-l-2 border-dashed border-retro-border ml-3 md:ml-6 space-y-12 py-2">
                        {EXPERIENCE.map((job, i) => (
                        <div key={i} className="relative pl-8 md:pl-12 group">
                            <div className="absolute -left-[6px] top-1 w-3 h-3 bg-retro-bg border-2 border-retro-accent group-hover:bg-retro-accent group-hover:shadow-[0_0_10px_var(--accent-main)] transition-all duration-300 rounded-sm"></div>
                            <div className="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-2">
                            <h4 className="text-xl text-retro-text font-pixel-bold group-hover:text-retro-accent transition-colors tracking-wide">{job.role}</h4>
                            <span className="text-xs bg-retro-accent/10 text-retro-accent px-2 py-1 border-2 border-retro-accent/20 mt-2 sm:mt-0 font-pixel">{job.period}</span>
                            </div>
                            <div className="text-retro-accent text-sm font-pixel-bold mb-4 flex items-center gap-2">
                                <Briefcase size={14} /> 
                                <span className="opacity-50">@</span>
                                {job.company.toUpperCase()}
                            </div>
                            <div className="relative bg-retro-bg/40 p-4 border-2 border-retro-border group-hover:border-retro-accent/30 transition-colors">
                                <CornerBrackets color="border-retro-dim group-hover:border-retro-accent/50" size="w-1.5 h-1.5" />
                                <p className="text-retro-text text-base leading-7 font-pixel relative z-10">
                                    {job.description}
                                </p>
                            </div>
                        </div>
                        ))}
                    </div>

                    <div>
                        <div className="flex items-center gap-3 mb-6 border-b-2 border-retro-border pb-2">
                            <Cpu size={18} className="text-retro-accent" />
                            <span className="text-retro-accent font-pixel-bold text-sm">FIRMWARE UPDATES [EDU]</span>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                            {EDUCATION.map((edu, i) => (
                            <div key={i} className="bg-retro-bg/60 p-4 border-2 border-retro-border hover:border-retro-accent/50 transition-all relative group overflow-hidden">
                                <div className="absolute top-0 right-0 p-2 opacity-20 group-hover:opacity-100 transition-opacity">
                                    <GraduationCap size={16} className="text-retro-accent" />
                                </div>
                                <h4 className="text-retro-text font-pixel-bold mb-1 text-sm">{edu.school}</h4>
                                {/* Combined degree and specialization onto one line */}
                                <p className="text-xs text-retro-accent mb-3">{edu.degree}</p>
                                <div className="text-retro-dim text-[10px] border-t-2 border-retro-border pt-2 mt-2 font-pixel">
                                    STATUS: <span className="text-retro-text whitespace-pre-wrap">{edu.details}</span>
                                </div>
                            </div>
                            ))}
                        </div>
                    </div>
                </div>
            );

            const ProjectsContent = () => (
                <div className="h-full flex flex-col">
                    <div className="flex items-center justify-between mb-8 bg-retro-bg p-2 border-2 border-retro-border">
                    <div className="flex items-center gap-2 text-retro-accent text-xs font-pixel-bold">
                        <Folder size={14} />
                        <span>ROOT/PROJECTS/</span>
                    </div>
                    <div className="text-xs text-retro-dim font-pixel">
                        INDEX: {PROJECTS.length} // FREE_SPACE: 12%
                    </div>
                    </div>

                    <div className="grid grid-cols-1 gap-6">
                    {PROJECTS.map((project, i) => (
                        <div key={i} className="group relative bg-retro-bg/60 border-2 border-retro-border hover:border-retro-accent/50 transition-colors p-6 flex flex-col md:flex-row gap-6">
                        <CornerBrackets color="border-retro-border group-hover:border-retro-accent/50" />
                        <div className="w-full md:w-32 h-24 bg-retro-panel border-2 border-retro-border flex flex-col items-center justify-center gap-2 group-hover:bg-retro-accent/10 group-hover:border-retro-accent/30 transition-all">
                            <Layers size={24} className="text-retro-dim group-hover:text-retro-accent transition-colors" />
                            <span className="text-[9px] font-pixel-bold text-retro-dim group-hover:text-retro-accent">{project.type}</span>
                            <div className="flex gap-1 mt-1">
                                <div className="w-1 h-1 bg-retro-dim rounded-full group-hover:bg-retro-accent"></div>
                                <div className="w-1 h-1 bg-retro-dim rounded-full group-hover:bg-retro-accent delay-75"></div>
                                <div className="w-1 h-1 bg-retro-dim rounded-full group-hover:bg-retro-accent delay-150"></div>
                            </div>
                        </div>
                        <div className="flex-1 relative z-10">
                            <div className="flex justify-between items-start mb-2 border-b-2 border-dashed border-retro-border pb-2">
                                <h4 className="text-lg text-retro-text font-pixel-bold group-hover:text-retro-accent transition-colors">{project.title}</h4>
                                <span className="text-[9px] text-retro-dim font-pixel border-2 border-retro-border px-1">{project.coords}</span>
                            </div>
                            <p className="text-sm text-retro-dim mb-4 leading-6 font-pixel">{project.desc}</p>
                            <div className="flex flex-wrap gap-2">
                                {project.tags.map(tag => (
                                <span key={tag} className="text-[10px] px-2 py-1 bg-retro-content text-retro-dim border-2 border-retro-border uppercase tracking-wider group-hover:text-retro-accent group-hover:border-retro-accent/30 transition-colors">
                                    {tag}
                                </span>
                                ))}
                            </div>
                        </div>
                        </div>
                    ))}
                    </div>
                </div>
            );

            const TerminalContent = () => (
                <div className="font-pixel text-xl text-retro-text h-full flex flex-col bg-retro-content p-4 border-2 border-retro-border relative overflow-hidden">
                    <div className="absolute inset-0 opacity-5 bg-[repeating-linear-gradient(0deg,transparent,transparent_2px,var(--accent-main)_2px,var(--accent-main)_4px)] pointer-events-none"></div>
                    <div className="mb-4 text-retro-dim border-b-2 border-retro-border pb-2">
                        Atlas_OS [v64.0] <br/>
                        (c) Gevin Zhu Industries.
                    </div>
                    <div className="flex-1 space-y-3 relative z-10">
                        <div className="flex gap-2">
                            <span className="text-retro-accent">user@atlas:~$</span> 
                            <span>load_profile --verbose</span>
                        </div>
                        <div className="pl-4 text-retro-dim border-l-2 border-retro-border">
                            [OK] Loading assets...<br/>
                            [OK] Mounting skills...<br/>
                            [OK] Overclocking GPU...<br/>
                        </div>
                        <div className="mt-4 flex gap-2">
                            <span className="text-retro-accent">user@atlas:~$</span> 
                            <span>check_status</span>
                        </div>
                        <div className="pl-4 text-retro-dim border-l-2 border-retro-border">
                            <span className="text-retro-text font-bold">ONLINE</span> - All systems nominal.<br/>
                            <span className="text-retro-accent flex items-center gap-2 mt-1">[WARN] Coffee reserves critical. <AlertTriangle size={12}/></span>
                        </div>
                        <div className="mt-4 flex items-center gap-2">
                            <span className="text-retro-accent">user@atlas:~$</span> 
                            <span className="w-2.5 h-5 bg-retro-accent animate-pulse block shadow-[0_0_5px_var(--accent-main)]"></span>
                        </div>
                    </div>
                </div>
            )

            const ContactContent = () => (
                // Use justify-center to center, and apply a negative margin-top to visually bias the box lower.
                <div className="flex flex-col h-full w-full items-center justify-center relative"> 
                    <div className="bg-retro-panel p-10 border-2 border-retro-border shadow-[0_0_20px_rgba(0,0,0,0.5)] max-w-lg w-full relative backdrop-blur-sm mt-16">
                        <CornerBrackets color="border-retro-accent" />
                        
                        {/* SECURE_LINK Updated to use text-[0.5rem] and font-pixel-bold for consistency with SYS_DIAGNOSTICS */}
                        <div className="absolute -top-3 left-1/2 -translate-x-1/2 bg-retro-bg px-4 text-[0.5rem] font-pixel-bold text-retro-accent tracking-widest border-2 border-retro-border uppercase">SECURE_LINK</div>
                        
                        <Monitor size={48} className="text-retro-accent mx-auto mb-6 drop-shadow-[0_0_8px_var(--accent-glow)]" strokeWidth={1.5} />
                        <h2 className="text-2xl font-pixel-bold text-retro-text mb-4 tracking-wide text-center">OPEN CHANNEL?</h2>
                        
                        <a href={`mailto:${PERSONAL_INFO.email}`} className="group relative inline-block w-full py-4 bg-retro-accent/10 hover:bg-retro-accent text-retro-accent hover:text-retro-inverse border-2 border-retro-accent transition-all overflow-hidden">
                            <div className="absolute inset-0 bg-[repeating-linear-gradient(45deg,transparent,transparent_5px,rgba(0,0,0,0.1)_5px,rgba(0,0,0,0.1)_10px)]"></div>
                            <div className="flex items-center justify-center gap-2 relative z-10 font-pixel-bold text-sm uppercase">
                                <Wifi size={16} className="animate-pulse" />
                                <span>TRANSMIT_MESSAGE()</span>
                            </div>
                        </a>
                    </div>
                </div>
            )

            // --- NEW COMPONENT: ACCESSIBILITY MENU ---
            const A11yMenu = ({ settings, toggleSetting, setSetting, closeMenu }) => {
                return (
                    <div className="absolute left-24 bottom-4 w-64 bg-retro-panel border-2 border-retro-accent p-4 shadow-[0_0_20px_rgba(0,0,0,0.5)] z-[100] font-pixel text-xs max-h-[80vh] overflow-y-auto scrollbar-hide">
                        <CornerBrackets color="border-retro-accent" />
                        
                        <div className="flex justify-between items-center mb-4 border-b border-retro-border pb-2 sticky top-0 bg-retro-panel z-10">
                            <span className="text-retro-accent font-bold tracking-widest">SYS_UTILS</span>
                            <button onClick={closeMenu} className="text-retro-dim hover:text-retro-accent"><X size={14}/></button>
                        </div>

                        <div className="space-y-3">
                            {/* 1. Readable Font */}
                            <div className="flex items-center justify-between group cursor-pointer" onClick={() => toggleSetting('font')}>
                                <div className="flex items-center gap-2 text-retro-text group-hover:text-retro-accent">
                                    <Type size={14} />
                                    <span>READABLE_FONT</span>
                                </div>
                                <div className={`w-3 h-3 border border-retro-accent ${settings.font ? 'bg-retro-accent' : ''}`}></div>
                            </div>

                            {/* 2. Reduce Motion */}
                            <div className="flex items-center justify-between group cursor-pointer" onClick={() => toggleSetting('motion')}>
                                <div className="flex items-center gap-2 text-retro-text group-hover:text-retro-accent">
                                    <Move size={14} />
                                    <span>REDUCE_MOTION</span>
                                </div>
                                <div className={`w-3 h-3 border border-retro-accent ${settings.motion ? 'bg-retro-accent' : ''}`}></div>
                            </div>

                            {/* 3. Clean View */}
                            <div className="flex items-center justify-between group cursor-pointer" onClick={() => toggleSetting('clean')}>
                                <div className="flex items-center gap-2 text-retro-text group-hover:text-retro-accent">
                                    <EyeOff size={14} />
                                    <span>CLEAN_VIEW</span>
                                </div>
                                <div className={`w-3 h-3 border border-retro-accent ${settings.clean ? 'bg-retro-accent' : ''}`}></div>
                            </div>

                            {/* 4. Grayscale */}
                            <div className="flex items-center justify-between group cursor-pointer" onClick={() => toggleSetting('grayscale')}>
                                <div className="flex items-center gap-2 text-retro-text group-hover:text-retro-accent">
                                    <Droplet size={14} />
                                    <span>GRAYSCALE</span>
                                </div>
                                <div className={`w-3 h-3 border border-retro-accent ${settings.grayscale ? 'bg-retro-accent' : ''}`}></div>
                            </div>

                            {/* 5. Change Hue */}
                            <div className="flex items-center justify-between group cursor-pointer" onClick={() => toggleSetting('hue')}>
                                <div className="flex items-center gap-2 text-retro-text group-hover:text-retro-accent">
                                    <Palette size={14} />
                                    <span>
                                        {settings.hue > 0 ? `HUE: ${settings.hue}` : 'CHANGE_HUE'}
                                    </span>
                                </div>
                                <div className={`w-3 h-3 border border-retro-accent ${settings.hue > 0 ? 'bg-retro-accent' : ''}`}></div>
                            </div>

                            {/* 6. Wide Spacing */}
                            <div className="flex items-center justify-between group cursor-pointer" onClick={() => toggleSetting('spacing')}>
                                <div className="flex items-center gap-2 text-retro-text group-hover:text-retro-accent">
                                    <MoveHorizontal size={14} />
                                    <span>WIDE_SPACING</span>
                                </div>
                                <div className={`w-3 h-3 border border-retro-accent ${settings.spacing ? 'bg-retro-accent' : ''}`}></div>
                            </div>

                            {/* 7. Link Highlights */}
                            <div className="flex items-center justify-between group cursor-pointer" onClick={() => toggleSetting('links')}>
                                <div className="flex items-center gap-2 text-retro-text group-hover:text-retro-accent">
                                    <Link2 size={14} />
                                    <span>HIGHLIGHT_LINKS</span>
                                </div>
                                <div className={`w-3 h-3 border border-retro-accent ${settings.links ? 'bg-retro-accent' : ''}`}></div>
                            </div>

                            {/* 8. Cursor Highlight (Halo) */}
                            <div className="flex items-center justify-between group cursor-pointer" onClick={() => toggleSetting('highlight')}>
                                <div className="flex items-center gap-2 text-retro-text group-hover:text-retro-accent">
                                    <Target size={14} />
                                    <span>CURSOR_HALO</span>
                                </div>
                                <div className={`w-3 h-3 border border-retro-accent ${settings.highlight ? 'bg-retro-accent' : ''}`}></div>
                            </div>

                            {/* 9. Reading Guide */}
                            <div className="flex items-center justify-between group cursor-pointer" onClick={() => toggleSetting('guide')}>
                                <div className="flex items-center gap-2 text-retro-text group-hover:text-retro-accent">
                                    <ScanLine size={14} />
                                    <span>READING_GUIDE</span>
                                </div>
                                <div className={`w-3 h-3 border border-retro-accent ${settings.guide ? 'bg-retro-accent' : ''}`}></div>
                            </div>
                        </div>
                    </div>
                )
            }

            // --- MAIN APP COMPONENT ---
            function App() {
                const [booting, setBooting] = useState(true);
                const [crtEnabled, setCrtEnabled] = useState(true);
                
                // Day/Night mode
                const [isDayMode, setIsDayMode] = useState(false);

                // Add Game Reset Key to force re-mount
                const [gameResetKey, setGameResetKey] = useState(0);
                
                // Accessibility State
                const [a11yMenuOpen, setA11yMenuOpen] = useState(false);
                const [a11ySettings, setA11ySettings] = useState({
                    font: false,
                    motion: false,
                    clean: false,
                    textSize: 100, 
                    grayscale: false,
                    hue: 0, // Hue is now a number (degrees) instead of boolean
                    spacing: false,
                    links: false,
                    highlight: false,
                    guide: false
                });

                // Refs for mouse tracking visuals
                const cursorRef = useRef(null);
                const guideRef = useRef(null);

                // Apply theme class to body
                useEffect(() => {
                    if (isDayMode) {
                        document.body.classList.add('day-mode');
                    } else {
                        document.body.classList.remove('day-mode');
                    }
                }, [isDayMode]);

                // Apply Font Size to Root HTML element
                useEffect(() => {
                    document.documentElement.style.fontSize = `${a11ySettings.textSize}%`;
                }, [a11ySettings.textSize]);

                // Apply Hue Rotation
                useEffect(() => {
                    document.documentElement.style.setProperty('--hue-rotate', `${a11ySettings.hue}deg`);
                    // We toggle the class based on if hue > 0
                    if (a11ySettings.hue > 0) {
                        document.body.classList.add('a11y-hue-filter');
                    } else {
                        document.body.classList.remove('a11y-hue-filter');
                    }
                }, [a11ySettings.hue]);

                const toggleA11ySetting = (key) => {
                    if (key === 'hue') {
                        // Cycle hue: 0 -> 60 -> 120 -> 180 -> 240 -> 300 -> 0
                        setA11ySettings(prev => {
                            const nextHue = (prev.hue + 60) % 360;
                            return { ...prev, hue: nextHue };
                        });
                    } else {
                        setA11ySettings(prev => ({ ...prev, [key]: !prev[key] }));
                    }
                }

                const setA11ySettingValue = (key, value) => {
                    setA11ySettings(prev => ({ ...prev, [key]: value }));
                }

                // Helper to construct the main container classes
                const getContainerClasses = () => {
                    let classes = "h-screen w-screen bg-retro-bg text-retro-text overflow-hidden select-none relative flex font-pixel ";
                    if (a11ySettings.font) classes += "a11y-font ";
                    if (a11ySettings.motion) classes += "a11y-motion ";
                    if (a11ySettings.clean) classes += "a11y-clean ";
                    if (a11ySettings.grayscale) classes += "a11y-grayscale ";
                    // hue class is handled via body classList in useEffect for global scope
                    if (a11ySettings.spacing) classes += "a11y-spacing ";
                    if (a11ySettings.links) classes += "a11y-links ";
                    return classes;
                };

                // Initial window positions
                const [windows, setWindows] = useState([
                    { id: 'about', title: 'USER_PROFILE.EXE', icon: User, isOpen: true, isMinimized: false, zIndex: 1, position: {x: 100, y: 50}, content: <AboutContent /> },
                    { id: 'projects', title: 'PROJECTS.DIR', icon: Layers, isOpen: false, isMinimized: false, zIndex: 0, position: {x: 120, y: 70}, content: <ProjectsContent /> },
                    { id: 'experience', title: 'LOGS.TXT', icon: FileText, isOpen: false, isMinimized: false, zIndex: 0, position: {x: 140, y: 90}, content: <ExperienceContent /> },
                    { id: 'terminal', title: 'CMD_PROMPT', icon: Terminal, isOpen: false, isMinimized: false, zIndex: 0, position: {x: 160, y: 110}, content: <TerminalContent /> },
                    { id: 'contact', title: 'MAIL_CLIENT', icon: Mail, isOpen: false, isMinimized: false, zIndex: 0, position: {x: 180, y: 130}, content: <ContactContent /> },
                ]);

                const [dragState, setDragState] = useState({ isDragging: false, windowId: null, offsetX: 0, offsetY: 0 });

                const handleSystemReset = () => {
                    // Close all windows
                    setWindows(prev => prev.map((w, i) => ({ ...w, isOpen: false, isMinimized: false, zIndex: 0, position: { x: 100 + (i * 20), y: 50 + (i * 20) } })));
                    // Increment key to force SnakeGame component to unmount and remount
                    setGameResetKey(prev => prev + 1);
                };

                const toggleWindow = (id) => {
                    setWindows(prev => prev.map(w => {
                        if (w.id === id) {
                            const maxZ = Math.max(...prev.map(p => p.zIndex));
                            return { ...w, isOpen: true, isMinimized: false, zIndex: maxZ + 1 };
                        }
                        return w;
                    }));
                };

                const closeWindow = (id) => setWindows(prev => prev.map(w => w.id === id ? { ...w, isOpen: false } : w));
                const minimizeWindow = (id) => setWindows(prev => prev.map(w => w.id === id ? { ...w, isMinimized: true } : w));
                const focusWindow = (id) => setWindows(prev => {
                    const maxZ = Math.max(...prev.map(p => p.zIndex));
                    return prev.map(w => w.id === id ? { ...w, zIndex: maxZ + 1 } : w);
                });

                const handleMouseDown = (e, id) => {
                    const win = windows.find(w => w.id === id);
                    if(!win) return;
                    focusWindow(id);
                    setDragState({ isDragging: true, windowId: id, offsetX: e.clientX - win.position.x, offsetY: e.clientY - win.position.y });
                };

                const handleMouseMove = (e) => {
                    // A11Y Mouse Tracking logic (Direct DOM manipulation for performance)
                    if (a11ySettings.highlight && cursorRef.current) {
                        cursorRef.current.style.left = `${e.clientX}px`;
                        cursorRef.current.style.top = `${e.clientY}px`;
                    }
                    if (a11ySettings.guide && guideRef.current) {
                        guideRef.current.style.top = `${e.clientY}px`;
                    }

                    if(!dragState.isDragging) return;
                    setWindows(prev => prev.map(w => {
                        if(w.id === dragState.windowId) {
                            return { ...w, position: { x: e.clientX - dragState.offsetX, y: e.clientY - dragState.offsetY } }
                        }
                        return w;
                    }))
                };

                const handleMouseUp = () => setDragState({ isDragging: false, windowId: null, offsetX: 0, offsetY: 0 });
                
                const activeWindowId = windows.sort((a,b) => b.zIndex - a.zIndex).find(w => w.isOpen && !w.isMinimized)?.id;

                const renderContent = (id) => {
                    switch(id) {
                        case 'about': return <AboutContent />;
                        case 'projects': return <ProjectsContent />;
                        case 'experience': return <ExperienceContent />;
                        case 'terminal': return <TerminalContent />;
                        case 'contact': return <ContactContent />;
                        default: return null;
                    }
                };

                return (
                    <div className={getContainerClasses()}
                        onMouseMove={handleMouseMove}
                        onMouseUp={handleMouseUp}
                    >
                        {/* A11Y Visual Overlays */}
                        {a11ySettings.highlight && (
                            <div ref={cursorRef} className="fixed w-12 h-12 rounded-full bg-yellow-400/40 border-2 border-yellow-400 pointer-events-none z-[9999] -translate-x-1/2 -translate-y-1/2 mix-blend-difference"></div>
                        )}
                        {a11ySettings.guide && (
                            <div ref={guideRef} className="fixed left-0 w-full h-1 bg-yellow-400/60 pointer-events-none z-[9998] mix-blend-difference"></div>
                        )}

                        {booting && <BootScreen onComplete={() => setBooting(false)} />}
                        
                        {/* Disable CRT Overlay if Clean View is active or CRT button off */}
                        {crtEnabled && !a11ySettings.clean && <CRTOverlay />}

                        {/* REMOVED overflow-y-auto and scrollbar-hide to fix tooltip visibility */}
                        <div className="w-[5rem] h-full bg-retro-panel border-r-2 border-retro-border z-50 flex flex-col items-center justify-center py-6 shadow-[5px_0_20px_rgba(0,0,0,0.8)] relative">
                            <div className="absolute top-0 left-0 w-1 h-full bg-gradient-to-b from-retro-panel via-retro-accent/20 to-retro-panel"></div>
                            <div className="flex flex-col items-center justify-center w-full gap-4 relative z-10">
                                <ToolIcon label="RESET" icon={Grid} onClick={handleSystemReset} active={false} shadowDirection="down" />
                                
                                {/* PDF Button - Updated to use explicit rem sizing */}
                                <button 
                                    onClick={() => window.open(PERSONAL_INFO.social.resume, '_blank')}
                                    className="group relative flex flex-col items-center justify-center w-[3rem] h-[3rem] border-2 border-retro-border bg-retro-panel hover:bg-retro-bg text-retro-dim hover:text-retro-accent transition-all cursor-pointer shadow-[0_4px_0px_var(--accent-dim)] hover:shadow-[0_0_15px_var(--accent-glow)] hover:translate-y-[2px] hover:border-retro-accent"
                                >
                                    {/* Changed fixed 20px size to 1.5rem so it scales */}
                                    <HardDrive size="1.5rem" />
                                    {/* Changed text-[8px] to text-[0.5rem] so it scales */}
                                    <span className="text-[0.5rem] font-pixel-bold mt-1">PDF</span>

                                    <div className="absolute left-full ml-[1.25rem] opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50">
                                        <div className="relative bg-retro-panel text-retro-accent text-[0.625rem] px-3 py-1 border-2 border-retro-accent font-pixel-bold uppercase tracking-wider shadow-[0_0_10px_var(--accent-dim)] whitespace-nowrap">
                                            <CornerBrackets color="border-retro-accent" size="w-1.5 h-1.5" />
                                            <span className="relative z-10">&gt;&gt; RESUME</span>
                                        </div>
                                        <div className="absolute top-1/2 right-full w-3 h-[2px] bg-retro-accent transform -translate-y-1/2"></div>
                                    </div>
                                </button>
                                
                                {/* Divider - Fixed height in pixels is fine for lines, width scales */}
                                <div className="w-[2rem] h-[2px] bg-retro-border"></div> 
                                
                                <ToolIcon label="BIO" icon={User} onClick={() => toggleWindow('about')} active={activeWindowId === 'about'} shadowDirection="down" />
                                <ToolIcon label="WORK" icon={Folder} onClick={() => toggleWindow('projects')} active={activeWindowId === 'projects'} shadowDirection="down" />
                                <ToolIcon label="XP" icon={FileText} onClick={() => toggleWindow('experience')} active={activeWindowId === 'experience'} shadowDirection="down" />
                                <ToolIcon label="CMD" icon={Terminal} onClick={() => toggleWindow('terminal')} active={activeWindowId === 'terminal'} shadowDirection="down" />
                                <ToolIcon label="MSG" icon={Mail} onClick={() => toggleWindow('contact')} active={activeWindowId === 'contact'} shadowDirection="down" />
                                
                                <div className="w-[2rem] h-[2px] bg-retro-border"></div>
                                
                                <ToolIcon 
                                    label="CRT" 
                                    icon={Power} 
                                    onClick={() => setCrtEnabled(!crtEnabled)} 
                                    active={crtEnabled} 
                                    shadowDirection="down" 
                                    className={crtEnabled 
                                        ? "!border-green-500 !text-green-500 hover:!text-green-400 hover:!border-green-400 hover:shadow-[0_0_10px_#22c55e]" 
                                        : "!border-red-600 !text-red-600 !shadow-[0_4px_0px_rgba(220,38,38,0.3)] hover:!border-red-500 hover:!text-red-500 hover:shadow-[0_0_10px_#dc2626]"
                                    }
                                />

                                {/* Theme Toggle */}
                                <ToolIcon 
                                    label={isDayMode ? "NIGHT" : "DAY"} 
                                    icon={isDayMode ? Moon : Sun} 
                                    onClick={() => setIsDayMode(!isDayMode)} 
                                    active={false} 
                                    shadowDirection="down" 
                                    className={isDayMode 
                                        ? "!border-black !text-black hover:!text-zinc-700 hover:!border-zinc-700 hover:shadow-[0_0_10px_rgba(0,0,0,0.2)]" 
                                        : "!border-white !text-white hover:!text-zinc-200 hover:!border-zinc-200 hover:shadow-[0_0_10px_rgba(255,255,255,0.5)]"
                                    }
                                />

                                {/* Accessibility Menu Button */}
                                <ToolIcon 
                                    label="A11Y" 
                                    icon={Accessibility} 
                                    onClick={() => setA11yMenuOpen(!a11yMenuOpen)} 
                                    active={a11yMenuOpen} 
                                    shadowDirection="down" 
                                    className={a11yMenuOpen
                                        ? "!border-retro-accent !text-retro-accent !bg-retro-accent/10" 
                                        : ""
                                    }
                                />
                            </div>
                        </div>

                        {a11yMenuOpen && (
                            <A11yMenu 
                                settings={a11ySettings} 
                                toggleSetting={toggleA11ySetting} 
                                setSetting={setA11ySettingValue}
                                closeMenu={() => setA11yMenuOpen(false)}
                            />
                        )}

                        <div className="flex-1 relative bg-retro-bg overflow-hidden transition-colors duration-300">
                            <div className="absolute inset-0 pointer-events-none opacity-20"
                                style={{ 
                                    // Removed the radial-gradient (dots) and adjusted backgroundSize
                                    backgroundImage: `linear-gradient(to right, #71717a 1px, transparent 1px),
                                                    linear-gradient(to bottom, #71717a 1px, transparent 1px)`, 
                                    backgroundSize: '60px 60px' 
                                }}>
                            </div>
                            <div className="absolute top-8 right-8 text-retro-dim font-pixel-bold text-8xl opacity-10 pointer-events-none select-none tracking-tighter">ATLAS OS</div>
                            
                            {/* Bottom Left System Info */}
                            <div className="absolute bottom-8 left-8 text-retro-accent font-pixel text-sm pointer-events-none">
                                SYS_VER: 64.0.1 <br/> 
                                SECTOR: 07-G
                            </div>
                            
                            {/* Top Right Status */}
                            <div className="absolute top-8 right-8 text-retro-accent font-pixel text-sm text-right pointer-events-none select-none">
                                NET: SECURE <br/>
                                MEM: 640K
                            </div>

                            {windows.map(w => (
                                <WindowFrame
                                    key={w.id}
                                    {...w}
                                    onClose={() => closeWindow(w.id)}
                                    onMinimize={() => minimizeWindow(w.id)}
                                    onFocus={() => focusWindow(w.id)}
                                    onMouseDown={handleMouseDown}
                                    position={w.position}
                                >
                                    {renderContent(w.id)}
                                </WindowFrame>
                            ))}

                            {!windows.some(w => w.isOpen && !w.isMinimized) && (
                                <div className="absolute inset-0 z-0">
                                    {/* Added key prop to force reset */}
                                    <SnakeGame key={gameResetKey} isDayMode={isDayMode} />
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            // Mount the app
            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        } catch (err) {
            console.error(err);
            const el = document.getElementById('error-display');
            el.style.display = 'block';
            el.innerHTML = `<strong>CRITICAL FAILURE:</strong><br/>${err.message}<br/><br/>See console for stack trace.`;
        }
    </script>
</body>
</html>